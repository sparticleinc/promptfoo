(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[712],{2810:function(e,t,n){"use strict";let s,l;async function a(){if(s||(l||(l=fetch("/api/config").then(e=>e.json()).then(e=>s=e.apiBaseUrl)),await l),void 0===s)throw Error("API base URL is undefined");return s}n.d(t,{b:function(){return a}})},4712:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eG}});var s=n(7437),l=n(2265),a=n(2130),r=n(6882),i=n(3388),o=n(4033),c=n(3082),d=n(1116),u=n(8440),p=n(6507),h=n(5551),m=n(7760),x=n(6446),g=n(3391),j=n(4081),f=n(3226),v=n(819),b=n(8212),y=n(8864),Z=n(3375),C=n(9114),k=n(923),w=n(654),S=n(3295),N=n(2467),R=n(3457),I=n(1975),P=n(8276),E=n(9605),O=n(9190),F=n(2053),M=n(8339),T=n(2481),L=n(9394),D=n(6337),U=n(4660),A=n(4810);let W=(0,U.Ue)()((0,A.tJ)((e,t)=>({evalId:null,setEvalId:t=>e(()=>({evalId:t})),table:null,setTable:t=>e(()=>({table:t})),config:null,setConfig:t=>e(()=>({config:t})),maxTextLength:250,setMaxTextLength:t=>e(()=>({maxTextLength:t})),wordBreak:"break-word",setWordBreak:t=>e(()=>({wordBreak:t})),showInferenceDetails:!0,setShowInferenceDetails:t=>e(()=>({showInferenceDetails:t})),renderMarkdown:!1,setRenderMarkdown:t=>e(()=>({renderMarkdown:t})),prettifyJson:!1,setPrettifyJson:t=>e(()=>({prettifyJson:t})),showPrompts:!1,setShowPrompts:t=>e(()=>({showPrompts:t}))}),{name:"ResultsViewStorage",storage:(0,A.FL)(()=>localStorage)}));var _=function(){let{table:e,config:t,evalId:n}=W(),[a,r]=l.useState(!1),i=(e,t)=>{let n=URL.createObjectURL(e),s=document.createElement("a");s.href=n,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)},o=()=>{r(!1)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.Z,{onClick:()=>{r(!0)},children:[(0,s.jsx)(y.Z,{children:(0,s.jsx)(T.Z,{fontSize:"small"})}),(0,s.jsx)(b.Z,{children:"Download"})]}),(0,s.jsx)(L.Z,{onClose:o,open:a,children:(0,s.jsx)(D.Z,{children:(0,s.jsxs)(R.Z,{direction:"column",spacing:2,sx:{width:"100%"},children:[(0,s.jsx)(h.Z,{onClick:()=>{let e=M.default.dump(t),n=new Blob([e],{type:"text/yaml;charset=utf-8"});i(n,"promptfooconfig.yaml"),o()},startIcon:(0,s.jsx)(T.Z,{}),fullWidth:!0,sx:{justifyContent:"flex-start"},children:"Download YAML Config"}),(0,s.jsx)(h.Z,{onClick:()=>{if(!e){alert("No table data");return}let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});i(t,"".concat(n,"-table.json")),o()},startIcon:(0,s.jsx)(T.Z,{}),fullWidth:!0,sx:{justifyContent:"flex-start"},children:"Download Table JSON"}),(0,s.jsx)(h.Z,{onClick:()=>{if(!e){alert("No table data");return}let t=e.body.map((t,n)=>({chosen:t.outputs.filter(e=>e.pass).map(e=>e.text),rejected:t.outputs.filter(e=>!e.pass).map(e=>e.text),vars:t.test.vars,providers:e.head.prompts.map(e=>e.provider),prompts:e.head.prompts.map(e=>e.label||e.display||e.raw)})),s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});i(s,"".concat(n,"-dpo.json")),o()},startIcon:(0,s.jsx)(T.Z,{}),fullWidth:!0,sx:{justifyContent:"flex-start"},children:"Download DPO JSON"})]})})})]})},z=n(6704),V=n(1797),B=n(1101),J=n(9872),H=n(2653),G=n(3533),X=n(4740);let Y=["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7"];function q(e){let{table:t}=e,n=(0,l.useRef)(null),a=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!n.current)return;a.current&&a.current.destroy();let e=t.body.flatMap(e=>e.outputs.map(e=>e.score)),s=Math.min(...e),l=(Math.ceil(Math.max(...e))-Math.floor(s))/10,r=Array.from({length:11},(e,t)=>parseFloat((Math.floor(s)+t*l).toFixed(2))),i=t.head.prompts.map((e,n)=>{let s=t.body.flatMap(e=>e.outputs[n].score),a=r.map(e=>s.filter(t=>t>=e&&t<e+l).length);return{label:"Column ".concat(n+1),data:a,backgroundColor:Y[n%Y.length]}});a.current=new z.kL(n.current,{type:"bar",data:{labels:r,datasets:i},options:{animation:!1,plugins:{title:{display:!0,text:"Score Distribution"},legend:{display:!1},tooltip:{callbacks:{title:function(e){let t=e[0].datasetIndex;return"Column ".concat(t+1)},label:function(e){let t=e.dataIndex,n=r[t],s=r[t+1];return s?"".concat(n," <= score < ").concat(s):"".concat(n," <= score")}}}}}})},[t]),(0,s.jsx)("canvas",{ref:n,style:{maxHeight:"300px"}})}function $(e){let{table:t}=e,n=(0,l.useRef)(null),a=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!n.current)return;a.current&&a.current.destroy();let e=t.head.prompts.map((e,n)=>{let s=t.body.flatMap(e=>e.outputs[n]),l=s.filter(e=>e.pass).length,a=l/s.length*100;return{label:"Column ".concat(n+1),data:[a],backgroundColor:Y[n%Y.length]}});a.current=new z.kL(n.current,{type:"bar",data:{labels:["Pass Rate (%)"],datasets:e},options:{animation:!1,plugins:{title:{display:!0,text:"Pass rate"},legend:{display:!0}}}})},[t]),(0,s.jsx)("canvas",{ref:n,style:{maxHeight:"300px"}})}function K(e){let{table:t}=e,n=(0,l.useRef)(null),a=(0,l.useRef)(null),[r,i]=(0,l.useState)(0),[o,c]=(0,l.useState)(1),[d,u]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!n.current)return;a.current&&a.current.destroy();let e=t.body.flatMap(e=>e.outputs.map(e=>e.score)),s=Math.min(...e),l=Math.max(...e),i=t.body.map(e=>{let t=e.outputs[r].score,n=e.outputs[o].score;return{x:t,y:n,backgroundColor:n>t?"green":n<t?"red":"gray"}});a.current=new z.kL(n.current,{type:"scatter",data:{datasets:[{data:i,backgroundColor:i.map(e=>e.backgroundColor)},{type:"line",data:[{x:s,y:s},{x:l,y:l}],borderColor:"gray",borderWidth:1,borderDash:[5,5],pointRadius:0}]},options:{animation:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){let n=t.body[e.dataIndex],s=n.outputs[0].text,l=n.outputs[1].text;return s.length>30&&(s=s.substring(0,30)+"..."),l.length>30&&(l=l.substring(0,30)+"..."),"Output 1: ".concat(s,"\nOutput 2: ").concat(l)}}}},scales:{x:{title:{display:!0,text:"Prompt ".concat(r+1," Score")},ticks:{callback:function(e,t,n){let s=String(Math.round(100*Number(e)));return t===n.length-1&&(s+="%"),s}}},y:{title:{display:!0,text:"Prompt ".concat(o+1," Score")},ticks:{callback:function(e,t,n){let s=String(Math.round(100*Number(e)));return t===n.length-1&&(s+="%"),s}}}}}})},[t,r,o]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(L.Z,{open:d,onClose:()=>u(!1),children:[(0,s.jsx)(V.Z,{children:"Compare prompt outputs"}),(0,s.jsxs)(D.Z,{children:[(0,s.jsx)(j.Z,{sx:{m:1,minWidth:120},children:(0,s.jsx)(w.Z,{value:r,onChange:e=>i(Number(e.target.value)),children:t.head.prompts.map((e,t)=>(0,s.jsxs)(C.Z,{value:t,children:["Prompt ",t+1]},t))})}),(0,s.jsx)(j.Z,{sx:{m:1,minWidth:120},children:(0,s.jsx)(w.Z,{value:o,onChange:e=>c(Number(e.target.value)),children:t.head.prompts.map((e,t)=>(0,s.jsxs)(C.Z,{value:t,children:["Prompt ",t+1]},t))})})]})]}),(0,s.jsx)("canvas",{ref:n,style:{maxHeight:"300px",cursor:"pointer"},onClick:()=>u(!0)})]})}function Q(e){let{table:t}=e,n=(0,l.useRef)(null),a=(0,l.useRef)(null);return(0,l.useEffect)(()=>{var e;if(!n.current)return;a.current&&a.current.destroy();let s=Object.keys((null===(e=t.head.prompts[0].metrics)||void 0===e?void 0:e.namedScores)||{}),l=t.head.prompts.map((e,n)=>{let l=s.map(n=>{var s;let l=(null===(s=e.metrics)||void 0===s?void 0:s.namedScores[n])||0,a=Math.max(...t.head.prompts.map(e=>{var t;return(null===(t=e.metrics)||void 0===t?void 0:t.namedScores[n])||0}));return l/a});return{label:"".concat(t.head.prompts[n].provider),data:l,backgroundColor:Y[n%Y.length]}});a.current=new z.kL(n.current,{type:"bar",data:{labels:s,datasets:l},options:{scales:{y:{ticks:{callback:function(e,t,n){let s=String(Math.round(100*Number(e)));return t===n.length-1&&(s+="%"),s}}}},plugins:{tooltip:{callbacks:{title:function(e){return e[0].dataset.label},label:function(e){let t=e.parsed.y;return"".concat(s[e.dataIndex],": ").concat((100*t).toFixed(2),"% pass rate")}}}}}})},[t]),(0,s.jsx)("canvas",{ref:n,style:{maxHeight:"300px"}})}z.kL.register(z.vn,z.ST,z.ho,z.uw,z.f$,z.ZL,z.jn,z.od,z.u,z.wL);var ee=l.memo(function(e){var t;let{columnVisibility:n}=e,a=(0,B.Z)();z.kL.defaults.color="dark"===a.palette.mode?"#aaa":"#666";let[r,i]=(0,l.useState)(!0),{table:o}=W();if(!o||!r||o.head.prompts.length<2)return null;let c=o.body.flatMap(e=>e.outputs.map(e=>e.score)),d=new Set(c);return 1===d.size?null:(0,s.jsx)(X.SV,{fallback:null,children:(0,s.jsxs)(J.Z,{style:{position:"relative",padding:a.spacing(3)},children:[(0,s.jsx)(H.Z,{style:{position:"absolute",right:0,top:0},onClick:()=>i(!1),children:(0,s.jsx)(G.Z,{})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,s.jsx)("div",{style:{width:"33%"},children:(0,s.jsx)($,{table:o})}),(0,s.jsx)("div",{style:{width:"33%"},children:2===d.size&&Object.keys((null===(t=o.head.prompts[0].metrics)||void 0===t?void 0:t.namedScores)||{}).length>1?(0,s.jsx)(Q,{table:o}):(0,s.jsx)(q,{table:o})}),(0,s.jsx)("div",{style:{width:"33%"},children:(0,s.jsx)(K,{table:o})})]})]})})}),et=n(9116);n(5777);var en=n(3425),es=n(7660),el=n(3216),ea=n(182),er=n(5391),ei=n(1396),eo=n.n(ei),ec=n(2834),ed=e=>{let{open:t,contextText:n,commentText:l,onClose:a,onSave:r,onChange:i}=e;return(0,s.jsxs)(L.Z,{open:t,onClose:a,fullWidth:!0,maxWidth:"sm",children:[(0,s.jsx)(V.Z,{children:"Edit Comment"}),(0,s.jsxs)(D.Z,{children:[(0,s.jsx)(p.Z,{sx:{backgroundColor:"#f0f0f0",padding:2,marginBottom:2},children:n}),(0,s.jsx)(I.Z,{autoFocus:!0,margin:"dense",type:"text",fullWidth:!0,multiline:!0,rows:4,value:l,onChange:e=>i(e.target.value)})]}),(0,s.jsxs)(ec.Z,{children:[(0,s.jsx)(h.Z,{onClick:r,color:"primary",variant:"contained",children:"Save"}),(0,s.jsx)(h.Z,{onClick:a,color:"primary",children:"Cancel"})]})]})};n(8715);var eu=e=>{let{lookup:t}=e;return t&&Object.keys(t).length?(0,s.jsx)("div",{className:"custom-metric-container",children:Object.entries(t).map(e=>{let[t,n]=e;return t&&void 0!==n?(0,s.jsxs)("span",{children:[t,": ",n.toFixed(2)]},t):null})}):null},ep=n(5446),eh=n(9329),em=n(4719),ex=n(3701),eg=n(9279),ej=n(666),ef=n(5795),ev=n(6988),eb=n(4147);function ey(e){let{gradingResults:t}=e;return t?(0,s.jsxs)(p.Z,{mt:2,children:[(0,s.jsx)(f.Z,{variant:"subtitle1",children:"Assertions"}),(0,s.jsx)(ef.Z,{children:(0,s.jsxs)(ex.Z,{children:[(0,s.jsx)(ev.Z,{children:(0,s.jsxs)(eb.Z,{children:[(0,s.jsx)(ej.Z,{style:{fontWeight:"bold"},children:"Pass"}),(0,s.jsx)(ej.Z,{style:{fontWeight:"bold"},children:"Score"}),(0,s.jsx)(ej.Z,{style:{fontWeight:"bold"},children:"Type"}),(0,s.jsx)(ej.Z,{style:{fontWeight:"bold"},children:"Value"}),(0,s.jsx)(ej.Z,{style:{fontWeight:"bold"},children:"Reason"})]})}),(0,s.jsx)(eg.Z,{children:t.map((e,t)=>{var n,l;return(0,s.jsxs)(eb.Z,{children:[(0,s.jsx)(ej.Z,{children:e.pass?"✅":"❌"}),(0,s.jsx)(ej.Z,{children:e.score.toFixed(2)}),(0,s.jsx)(ej.Z,{children:(null===(n=e.assertion)||void 0===n?void 0:n.type)||""}),(0,s.jsx)(ej.Z,{style:{whiteSpace:"pre-wrap"},children:(null===(l=e.assertion)||void 0===l?void 0:l.value)?String(e.assertion.value):"-"}),(0,s.jsx)(ej.Z,{style:{whiteSpace:"pre-wrap"},children:e.reason})]},t)})})]})})]}):null}function eZ(e){let{open:t,onClose:n,prompt:a,provider:r,output:i,gradingResults:o}=e,[c,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{d(!1)},[a]);let u=async e=>{await navigator.clipboard.writeText(e),d(!0)};return(0,s.jsxs)(L.Z,{open:t,onClose:n,fullWidth:!0,maxWidth:"lg",children:[(0,s.jsxs)(V.Z,{children:["Details",r&&": ".concat(r)]}),(0,s.jsxs)(D.Z,{children:[(0,s.jsxs)(p.Z,{mb:2,children:[(0,s.jsx)(f.Z,{variant:"subtitle1",style:{marginBottom:"1rem"},children:"Prompt"}),(0,s.jsx)(ep.u,{readOnly:!0,value:a,style:{width:"100%",padding:"0.75rem"},maxRows:20}),(0,s.jsx)(H.Z,{onClick:()=>u(a),style:{position:"absolute",right:"10px",top:"10px"},children:c?(0,s.jsx)(em.Z,{}):(0,s.jsx)(eh.Z,{})})]}),i&&(0,s.jsxs)(p.Z,{my:2,children:[(0,s.jsx)(f.Z,{variant:"subtitle1",style:{marginBottom:"1rem",marginTop:"1rem"},children:"Output"}),(0,s.jsx)(ep.u,{readOnly:!0,maxRows:20,value:i,style:{width:"100%",padding:"0.75rem"}})]}),(0,s.jsx)(ey,{gradingResults:o})]}),(0,s.jsx)(ec.Z,{children:(0,s.jsx)(h.Z,{onClick:n,children:"Close"})})]})}var eC=n(9396),ek=n(4173),ew=function(){let e=(0,B.Z)(),[t,n]=l.useState(!1),a=()=>{n(!1)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:{textAlign:"center",marginTop:20,marginBottom:40},children:(0,s.jsx)(h.Z,{variant:"text",color:"primary",startIcon:(0,s.jsx)(eC.Z,{}),onClick:()=>{n(!0)},children:"Generate test cases"})}),(0,s.jsxs)(L.Z,{open:t,onClose:a,children:[(0,s.jsx)(V.Z,{children:"Run on Command Line"}),(0,s.jsx)(D.Z,{children:(0,s.jsxs)(ek.Z,{children:[(0,s.jsx)("p",{children:"This feature is in beta. UI coming soon."}),(0,s.jsxs)("p",{children:["Run"," ",(0,s.jsx)(p.Z,{component:"code",sx:{backgroundColor:"dark"===e.palette.mode?"#424242":"#f0f0f0",padding:"2px 4px",borderRadius:"4px"},children:"promptfoo generate dataset"}),"to generate test cases on the command line."]})]})}),(0,s.jsx)(ec.Z,{children:(0,s.jsx)(h.Z,{onClick:a,color:"primary",children:"Close"})})]})]})},eS=n(2810);function eN(e){return null===e||0===e||1===e?"":"(".concat(e.toFixed(2),")")}function eR(e){return"string"==typeof e||"number"==typeof e?e.toString().length:Array.isArray(e)?e.reduce((e,t)=>e+eR(t),0):l.isValidElement(e)&&e.props.children?l.Children.toArray(e.props.children).reduce((e,t)=>e+eR(t),0):0}n(2604);let eI=l.memo(function(e){let t,{text:n,maxLength:a}=e,[r,i]=l.useState(!0),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("string"==typeof e||"number"==typeof e){let n=e.toString();return n.slice(0,a-t)}if(Array.isArray(e)){let n=[],s=t;for(let t of e){let e=eR(t);if(s+e>a){n.push(o(t,s));break}n.push(t),s+=e}return n}if(l.isValidElement(e)&&e.props.children){let n=eR(e.props.children);if(n>a-t)return l.cloneElement(e,{...e.props,children:o(e.props.children,t)})}return e};t=l.isValidElement(n)||"string"==typeof n?n:JSON.stringify(n);let c=r?o(t):t,d=eR(t)>a;return(0,s.jsxs)("div",{style:{cursor:d?"pointer":"normal"},onClick:()=>{i(!r)},children:[c,r&&eR(t)>a&&(0,s.jsx)("span",{children:"..."})]})}),eP=l.memo(function(e){var t,n,a,r,i,o,c,d,u,p,h,m;let x,g,j,f,v,{output:b,maxTextLength:y,rowIndex:Z,promptIndex:C,onRating:k,firstOutput:w,showDiffs:S,searchText:N,showStats:R}=e,{renderMarkdown:I,prettifyJson:E,showPrompts:O}=W(),[F,M]=l.useState(!1),[T,L]=l.useState(!1),D=()=>L(!T),[U,A]=l.useState(!1),[_,z]=l.useState((null===(t=b.gradingResult)||void 0===t?void 0:t.comment)||""),V=()=>{A(!0)},B="string"==typeof b.text?b.text:JSON.stringify(b.text),J=[],H=!1;if(B.startsWith("![")){let e=B.match(/^!\[.*?\]\((.*?)\)/);if(e){let t=e[1];x=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{loading:"lazy",src:t,alt:b.prompt,onClick:D}),T&&(0,s.jsx)("div",{className:"lightbox",onClick:D,children:(0,s.jsx)("img",{src:t,alt:b.prompt})})]}),H=!0}}else!b.pass&&B.includes("---")?B=(J=B.split("---")).slice(1).join("---"):J=[B];if(S&&w){let e,t="string"==typeof w.text?w.text:JSON.stringify(w.text);t.includes("---")&&(t=t.split("---").slice(1).join("---"));try{JSON.parse(t),JSON.parse(B),e=(0,et.CT)(t,B)}catch(n){e=t.includes(". ")&&B.includes(". ")?(0,et.SY)(t,B):(0,et.NV)(t,B)}x=(0,s.jsx)(s.Fragment,{children:e.map((e,t)=>e.added?(0,s.jsx)("ins",{children:e.value},t):e.removed?(0,s.jsx)("del",{children:e.value},t):(0,s.jsx)("span",{children:e.value},t))})}if(N)try{let e;let t=RegExp(N,"gi"),n=[];for(;null!==(e=t.exec(B));)n.push({start:e.index,end:t.lastIndex});x=(0,s.jsx)(s.Fragment,{children:n.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:B.substring(0,n[0].start)},"text-before"),n.map((e,t)=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"search-highlight",children:B.substring(e.start,e.end)},"match-"+t),(0,s.jsx)("span",{children:B.substring(e.end,n[t+1]?n[t+1].start:B.length)},"text-after-"+t)]}))]}):(0,s.jsx)("span",{children:B},"no-match")})}catch(e){console.error("Invalid regular expression:",e.message)}else if(I&&!H)x=(0,s.jsx)(en.U,{children:B});else if(E)try{x=(0,s.jsx)("pre",{children:JSON.stringify(JSON.parse(B),null,2)})}catch(e){}let G=l.useCallback(e=>{var t;k(e,void 0,null===(t=b.gradingResult)||void 0===t?void 0:t.comment)},[k,null===(n=b.gradingResult)||void 0===n?void 0:n.comment]),X=l.useCallback(()=>{let e=prompt("Set test score (0.0 - 1.0):",String(b.score));if(null!==e){let n=parseFloat(e);if(!isNaN(n)&&n>=0&&n<=1){var t;k(void 0,n,null===(t=b.gradingResult)||void 0===t?void 0:t.comment)}else alert("Invalid score. Please enter a value between 0.0 and 1.0.")}},[k,b.score,null===(a=b.gradingResult)||void 0===a?void 0:a.comment]);if(null===(r=b.tokenUsage)||void 0===r?void 0:r.completion){j=(0,s.jsxs)("span",{children:[Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(b.latencyMs)," ms"]});let e=b.tokenUsage.completion/(b.latencyMs/1e3);f=(0,s.jsx)("span",{children:Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(e)})}if(b.cost&&(v=(0,s.jsxs)("span",{children:["$",b.cost.toPrecision(2)]})),null===(i=b.tokenUsage)||void 0===i?void 0:i.cached)g=(0,s.jsxs)("span",{children:[Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(b.tokenUsage.cached)," ","(cached)"]});else if(null===(o=b.tokenUsage)||void 0===o?void 0:o.total){let e=Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(null!==(h=b.tokenUsage.prompt)&&void 0!==h?h:0),t=Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(null!==(m=b.tokenUsage.completion)&&void 0!==m?m:0),n=Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(b.tokenUsage.total);g=(0,s.jsx)(P.Z,{title:"".concat(e," prompt tokens + ").concat(t," completion tokens = ").concat(n," total"),children:(0,s.jsxs)("span",{children:[n,("0"!==e||"0"!==t)&&" (".concat(e,"+").concat(t,")")]})})}let Y=(null===(c=b.gradingResult)||void 0===c?void 0:c.comment)&&"!highlight"!==b.gradingResult.comment?(0,s.jsx)("div",{className:"comment",onClick:V,children:b.gradingResult.comment}):null,q=R?(0,s.jsxs)("div",{className:"cell-detail",children:[g&&(0,s.jsxs)("div",{className:"stat-item",children:[(0,s.jsx)("strong",{children:"Tokens:"})," ",g]}),j&&(0,s.jsxs)("div",{className:"stat-item",children:[(0,s.jsx)("strong",{children:"Latency:"})," ",j]}),f&&(0,s.jsxs)("div",{className:"stat-item",children:[(0,s.jsx)("strong",{children:"Tokens/Sec:"})," ",f]}),v&&(0,s.jsxs)("div",{className:"stat-item",children:[(0,s.jsx)("strong",{children:"Cost:"})," ",v]})]}):null,$=(0,s.jsxs)("div",{className:"cell-actions",children:[b.prompt&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"action",onClick:()=>{M(!0)},children:(0,s.jsx)(P.Z,{title:"View ouput and test details",children:(0,s.jsx)("span",{children:"\uD83D\uDD0E"})})}),(0,s.jsx)(eZ,{open:F,onClose:()=>{M(!1)},prompt:b.prompt,provider:b.provider,gradingResults:null===(d=b.gradingResult)||void 0===d?void 0:d.componentResults,output:B})]}),(0,s.jsx)("span",{className:"action",onClick:()=>G(!0),children:(0,s.jsx)(P.Z,{title:"Mark test passed (score 1.0)",children:(0,s.jsx)("span",{children:"\uD83D\uDC4D"})})}),(0,s.jsx)("span",{className:"action",onClick:()=>G(!1),children:(0,s.jsx)(P.Z,{title:"Mark test failed (score 0.0)",children:(0,s.jsx)("span",{children:"\uD83D\uDC4E"})})}),(0,s.jsx)("span",{className:"action",onClick:X,children:(0,s.jsx)(P.Z,{title:"Set test score",children:(0,s.jsx)("span",{children:"\uD83D\uDD22"})})}),(0,s.jsx)("span",{className:"action",onClick:V,children:(0,s.jsx)(P.Z,{title:"Edit comment",children:(0,s.jsx)("span",{children:"✏️"})})})]}),K={};return(null===(u=b.gradingResult)||void 0===u?void 0:u.comment)==="!highlight"&&(K.backgroundColor="#ffffeb"),(0,s.jsxs)("div",{className:"cell",style:K,children:[b.pass?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"status pass",children:[(0,s.jsxs)("div",{className:"pill",children:["PASS ",(0,s.jsx)("span",{className:"score",children:eN(b.score)})]}),(0,s.jsx)(eu,{lookup:b.namedScores})]})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"status fail",children:[(0,s.jsxs)("div",{className:"pill",children:["FAIL",b.score>0?" ":"",(0,s.jsx)("span",{className:"score",children:eN(b.score)})]}),(0,s.jsx)(eu,{lookup:b.namedScores}),(0,s.jsx)("span",{className:"fail-reason",children:null===(p=J[0])||void 0===p?void 0:p.trim().split("\n").map((e,t)=>(0,s.jsxs)(l.Fragment,{children:[e,(0,s.jsx)("br",{})]},t))})]})}),O&&w.prompt&&(0,s.jsxs)("div",{className:"prompt",children:[(0,s.jsx)("span",{className:"pill",children:"Prompt"}),b.prompt]}),(0,s.jsx)(eI,{text:x||B,maxLength:y}),Y,q,$,(0,s.jsx)(ed,{open:U,contextText:b.text,commentText:_,onClose:()=>{A(!1)},onSave:()=>{k(void 0,void 0,_),A(!1)},onChange:z})]})});function eE(e){let{text:t,maxLength:n,expandedText:a,resourceId:r,className:i}=e,[o,c]=l.useState(!1);return(0,s.jsxs)("div",{className:"".concat(i||""),children:[(0,s.jsx)(eI,{text:t,maxLength:n}),a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.Z,{title:"View prompt",children:(0,s.jsx)("span",{className:"action",onClick:()=>{c(!0)},children:"\uD83D\uDD0E"})}),(0,s.jsx)(eZ,{open:o,onClose:()=>{c(!1)},prompt:a}),r&&(0,s.jsx)(P.Z,{title:"View other evals and datasets for this prompt",children:(0,s.jsx)("span",{className:"action",children:(0,s.jsx)(eo(),{href:"/prompts/?id=".concat(r),target:"_blank",children:(0,s.jsx)(er.Z,{fontSize:"small"})})})})]})]})}var eO=l.memo(function(e){let{maxTextLength:t,columnVisibility:n,wordBreak:r,filterMode:i,failureFilter:o,searchText:c,showStats:d,onFailureFilterToggle:u}=e,{evalId:x,table:g,setTable:j}=W();(0,a.Z)(g,"Table should be defined");let{head:v,body:b}=g,y=l.useCallback(async(e,t,n,s,l)=>{var a;let r=[...b],i={...r[e]},o=[...i.outputs],c=null!=n?n:o[t].pass,d=void 0===s?n?1:0:s||0;o[t].pass=c,o[t].score=d;let u={...o[t].gradingResult||{},pass:c,score:d,reason:"Manual result (overrides all other grading results)",comment:l,assertion:(null===(a=o[t].gradingResult)||void 0===a?void 0:a.assertion)||null};o[t].gradingResult=u,i.outputs=o,r[e]=i;let p={head:v,body:r};j(p);try{let e=await fetch("".concat(await (0,eS.b)(),"/api/eval/").concat(x),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:p})});if(!e.ok)throw Error("Network response was not ok")}catch(e){console.error("Failed to update table:",e)}},[b,v,j,x]),Z=Object.keys(n).length>0,k=l.useMemo(()=>{try{let e=RegExp(c,"i");return b.map((e,t)=>({...e,outputs:e.outputs.map((e,n)=>({...e,originalRowIndex:t,originalPromptIndex:n}))})).filter(t=>{let s="failures"===i?t.outputs.some((e,t)=>{let s="Prompt ".concat(t+1);return o[s]&&!e.pass&&(!Z||n[s])}):"different"!==i||!t.outputs.every(e=>e.text===t.outputs[0].text),l=!c||t.outputs.some(t=>{var n,s;let l="".concat(t.text," ").concat(Object.keys(t.namedScores)," ").concat((null===(n=t.gradingResult)||void 0===n?void 0:n.reason)||""," ").concat((null===(s=t.gradingResult)||void 0===s?void 0:s.comment)||"");return e.test(l)});return s&&l})}catch(e){return console.error("Invalid regular expression:",e.message),b}},[b,o,i,c,n,Z]),S=l.useMemo(()=>v.prompts.map((e,t)=>b.reduce((e,n)=>e+(n.outputs[t].pass?1:0),0)),[v.prompts,b]),N=l.useMemo(()=>v.prompts.map((e,t)=>b.reduce((e,n)=>{var s,l;return e+((null===(l=n.outputs[t].gradingResult)||void 0===l?void 0:null===(s=l.componentResults)||void 0===s?void 0:s.length)||0)},0)),[v.prompts,b]),R=l.useMemo(()=>v.prompts.map((e,t)=>b.reduce((e,n)=>{var s;let l=null===(s=n.outputs[t].gradingResult)||void 0===s?void 0:s.componentResults;return e+(l?l.filter(e=>e.pass).length:0)},0)),[v.prompts,b]),P=l.useMemo(()=>S.reduce((e,t,n,s)=>t>s[e]?n:e,0),[S]),E=S[P],O=l.useMemo(()=>(0,es.Cl)(),[]),{renderMarkdown:F}=W(),M=l.useMemo(()=>v.vars.length>0?[O.group({id:"vars",header:()=>(0,s.jsx)("span",{className:"font-bold",children:"Variables"}),columns:v.vars.map((e,n)=>O.accessor(e=>e.vars[n],{id:"Variable ".concat(n+1),header:()=>(0,s.jsx)(eE,{text:e,maxLength:t,className:"font-bold"}),cell:e=>{let n=e.getValue();return(0,s.jsx)("div",{className:"cell",children:F?(0,s.jsx)(en.U,{children:n}):(0,s.jsx)(eI,{text:n,maxLength:t})})},size:50}))})]:[],[O,v.vars,t,F]),T=l.useCallback((e,t)=>k[e].outputs[t],[k]),L=l.useCallback(e=>k[e].outputs[0],[k]),D=l.useMemo(()=>[O.group({id:"prompts",header:()=>(0,s.jsx)("span",{className:"font-bold",children:"Outputs"}),columns:v.prompts.map((e,n)=>O.accessor(e=>(function(e){if("string"==typeof e){let t=e.startsWith("[PASS]"),n=e;return e.startsWith("[PASS]")?n=n.slice(6):e.startsWith("[FAIL]")&&(n=n.slice(6)),{text:n,pass:t,score:t?1:0}}return e})(e.outputs[n]),{id:"Prompt ".concat(n+1),header:()=>{var l,a,r,c,p,h,x,g;let j=S[n]&&b.length?(S[n]/b.length*100).toFixed(2):"0.00",f=S[n]===E&&0!==E,v="Prompt ".concat(n+1),y=o[v]||!1,Z=d?(0,s.jsxs)("div",{className:"prompt-detail",children:[N[n]?(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Asserts:"})," ",R[n],"/",N[n]," passed"]}):null,(null===(l=e.metrics)||void 0===l?void 0:l.totalLatencyMs)?(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Avg Latency:"})," ",Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(e.metrics.totalLatencyMs/b.length)," ","ms"]}):null,(null===(r=e.metrics)||void 0===r?void 0:null===(a=r.tokenUsage)||void 0===a?void 0:a.total)?(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Avg Tokens:"})," ",Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(e.metrics.tokenUsage.total/b.length)]}):null,(null===(c=e.metrics)||void 0===c?void 0:c.totalLatencyMs)&&(null===(h=e.metrics)||void 0===h?void 0:null===(p=h.tokenUsage)||void 0===p?void 0:p.completion)?(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Tokens/Sec:"})," ",Intl.NumberFormat(void 0,{maximumFractionDigits:0}).format(e.metrics.tokenUsage.completion/(e.metrics.totalLatencyMs/1e3))]}):null,(null===(x=e.metrics)||void 0===x?void 0:x.cost)?(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Cost:"})," $",e.metrics.cost.toPrecision(2)]}):null]}):null,C=e.provider?e.provider.split(":"):[],k=C.length>1?(0,s.jsxs)(s.Fragment,{children:[C[0],":",(0,s.jsx)("strong",{children:C.slice(1).join(":")})]}):(0,s.jsx)("strong",{children:e.provider});return(0,s.jsxs)("div",{className:"output-header",children:[(0,s.jsxs)("div",{className:"pills",children:[e.provider?(0,s.jsx)("div",{className:"provider",children:k}):null,(0,s.jsx)("div",{className:"summary",children:(0,s.jsxs)("div",{className:"highlight ".concat(f?"success":""),children:[(0,s.jsxs)("strong",{children:[j,"% passing"]})," (",S[n],"/",b.length," cases)"]})}),(null===(g=e.metrics)||void 0===g?void 0:g.namedScores)&&Object.keys(e.metrics.namedScores).length>0?(0,s.jsx)(eu,{lookup:e.metrics.namedScores}):null]}),(0,s.jsx)(eE,{className:"prompt-container",text:e.label||e.display||e.raw,expandedText:e.raw,maxLength:t,resourceId:e.id}),Z,"failures"===i&&(0,s.jsx)(ea.Z,{sx:{"& .MuiFormControlLabel-label":{fontSize:"0.75rem"}},control:(0,s.jsx)(m.Z,{checked:y,onChange:e=>u(v,e.target.checked)}),label:"Show failures"})]})},cell:e=>{var l,a;let r=T(e.row.index,n);return(0,s.jsx)(eP,{output:r,maxTextLength:t,rowIndex:e.row.index,promptIndex:n,onRating:y.bind(null,null!==(l=r.originalRowIndex)&&void 0!==l?l:e.row.index,null!==(a=r.originalPromptIndex)&&void 0!==a?a:n),firstOutput:L(e.row.index),showDiffs:"different"===i,searchText:c,showStats:d})}}))})],[O,v.prompts,S,b.length,E,o,d,N,R,t,u,i,c,T,L,y]),U=l.useMemo(()=>{let e=b.some(e=>e.description);return e?{accessorFn:e=>e.description||"",id:"description",header:()=>(0,s.jsx)("span",{className:"font-bold",children:"Description"}),cell:e=>(0,s.jsx)(eI,{text:String(e.getValue()),maxLength:t}),size:50}:null},[b,t]),A=l.useMemo(()=>{let e=[];return U&&e.push(U),e.push(...M,...D),e},[U,M,D]),[_,z]=l.useState({pageIndex:0,pageSize:50}),V=(0,el.b7)({data:k,columns:A,columnResizeMode:"onChange",getCoreRowModel:(0,es.sC)(),getPaginationRowModel:(0,es.G_)(),state:{columnVisibility:n,pagination:_}});return(0,s.jsxs)("div",{children:[(0,s.jsxs)("table",{className:"results-table firefox-fix ".concat(t<=25?"compact":""),style:{wordBreak:r},children:[(0,s.jsx)("thead",{children:V.getHeaderGroups().map(e=>(0,s.jsx)("tr",{className:"header",children:e.headers.map(e=>(0,s.jsxs)("th",{colSpan:e.colSpan,style:{width:e.getSize()},children:[e.isPlaceholder?null:(0,el.ie)(e.column.columnDef.header,e.getContext()),(0,s.jsx)("div",{onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),className:"resizer ".concat(e.column.getIsResizing()?"isResizing":"")})]},e.id))},e.id))}),(0,s.jsx)("tbody",{children:V.getRowModel().rows.map((e,t)=>{let n=!1;return(0,s.jsx)("tr",{children:e.getVisibleCells().map(e=>{let l=e.column.id.startsWith("Variable")||"description"===e.column.id,a=!l&&!n;return a&&(n=!0),(0,s.jsx)("td",{style:{width:e.column.getSize()},className:"".concat(l?"variable":""," ").concat(0!==t||l?"":"first-prompt-row"," ").concat(a?"first-prompt-col":""),children:(0,el.ie)(e.column.columnDef.cell,e.getContext())},e.id)})},e.id)})})]}),V.getPageCount()>1&&(0,s.jsxs)(p.Z,{className:"pagination",sx:{display:"flex",alignItems:"center",gap:2},children:[(0,s.jsx)(h.Z,{onClick:()=>{z(e=>({...e,pageIndex:Math.max(e.pageIndex-1,0)})),window.scrollTo(0,0)},disabled:0===V.getState().pagination.pageIndex,variant:"contained",children:"Previous"}),(0,s.jsxs)(f.Z,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:["Page",(0,s.jsx)(I.Z,{size:"small",type:"number",value:V.getState().pagination.pageIndex+1,onChange:e=>{let t=e.target.value?Number(e.target.value)-1:0;z(e=>({...e,pageIndex:Math.min(Math.max(t,0),V.getPageCount()-1)}))},InputProps:{style:{width:"60px",textAlign:"center"}},variant:"outlined"}),(0,s.jsxs)("span",{children:["of ",V.getPageCount()]})]}),(0,s.jsx)(h.Z,{onClick:()=>{z(e=>({...e,pageIndex:Math.min(e.pageIndex+1,V.getPageCount()-1)})),window.scrollTo(0,0)},disabled:V.getState().pagination.pageIndex+1>=V.getPageCount(),variant:"contained",children:"Next"}),(0,s.jsxs)(f.Z,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,s.jsxs)(w.Z,{value:_.pageSize,onChange:e=>{z({pageIndex:0,pageSize:Number(e.target.value)}),window.scrollTo(0,0)},displayEmpty:!0,inputProps:{"aria-label":"Results per page"},size:"small",sx:{m:1,minWidth:80},children:[(0,s.jsx)(C.Z,{value:10,children:"10"}),(0,s.jsx)(C.Z,{value:50,children:"50"}),(0,s.jsx)(C.Z,{value:100,children:"100"}),(0,s.jsx)(C.Z,{value:500,children:"500"}),(0,s.jsx)(C.Z,{value:1e3,children:"1000"})]}),(0,s.jsx)("span",{children:"results per page"})]})]}),(0,s.jsx)(ew,{})]})}),eF=n(7175);function eM(e){let{open:t,onClose:a}=e,{config:r}=W(),i=l.useRef(null),[o,c]=l.useState(!1),[d,u]=l.useState("");l.useEffect(()=>{t&&(async()=>{let{default:e}=await Promise.resolve().then(n.bind(n,8339));u(e.dump(r))})()},[t,r]);let m=()=>{c(!1),a()};return(0,s.jsxs)(L.Z,{open:t,onClose:m,"aria-labelledby":"config-dialog-title",maxWidth:"md",fullWidth:!0,children:[(0,s.jsx)(V.Z,{id:"config-dialog-title",children:(0,s.jsxs)(p.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,s.jsx)(f.Z,{variant:"h6",style:{flexGrow:1},children:"Config"}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(P.Z,{title:"Copy to clipboard",children:(0,s.jsx)(H.Z,{onClick:()=>{i.current&&(i.current.select(),document.execCommand("copy"),c(!0))},children:o?(0,s.jsx)(em.Z,{}):(0,s.jsx)(eF.Z,{})})}),(0,s.jsx)(P.Z,{title:"Download .yaml",children:(0,s.jsx)(H.Z,{onClick:()=>{let e=new Blob([d],{type:"text/yaml;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="config.yaml",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},children:(0,s.jsx)(T.Z,{})})})]})]})}),(0,s.jsx)(D.Z,{children:(0,s.jsx)(f.Z,{variant:"body1",component:"div",children:(0,s.jsx)("textarea",{ref:i,readOnly:!0,value:d,style:{width:"100%",minHeight:"400px",fontFamily:"monospace",border:"1px solid #ccc"}})})}),(0,s.jsx)(ec.Z,{children:(0,s.jsx)(h.Z,{onClick:m,color:"primary",children:"Close"})})]})}var eT=e=>{let{open:t,onClose:n,shareUrl:a}=e,r=(0,l.useRef)(null),[i,o]=(0,l.useState)(!1),c=()=>{n(),o(!1)};return(0,s.jsxs)(L.Z,{open:t,onClose:c,PaperProps:{style:{minWidth:"min(660px, 100%)"}},children:[(0,s.jsx)(V.Z,{children:"Your eval is ready to share"}),(0,s.jsxs)(D.Z,{children:[(0,s.jsx)(I.Z,{inputRef:r,value:a,fullWidth:!0,InputProps:{readOnly:!0,endAdornment:(0,s.jsx)(H.Z,{onClick:()=>{r.current&&(r.current.select(),document.execCommand("copy"),o(!0))},children:i?(0,s.jsx)(em.Z,{}):(0,s.jsx)(eF.Z,{})})}}),(0,s.jsx)(ek.Z,{sx:{fontSize:"0.75rem"},children:"Shared URLs are deleted after 2 weeks."})]}),(0,s.jsx)(ec.Z,{children:(0,s.jsx)(h.Z,{onClick:c,color:"primary",children:"Close"})})]})},eL=n(33),eD=e=>{let{open:t,onClose:n}=e,{maxTextLength:l,setMaxTextLength:a,wordBreak:r,setWordBreak:i,showInferenceDetails:o,setShowInferenceDetails:c,renderMarkdown:d,setRenderMarkdown:u,prettifyJson:x,setPrettifyJson:g,showPrompts:j,setShowPrompts:v}=W();return(0,s.jsxs)(L.Z,{open:t,onClose:n,fullWidth:!0,maxWidth:"sm",children:[(0,s.jsx)(V.Z,{children:"Table View Settings"}),(0,s.jsxs)(D.Z,{children:[(0,s.jsx)(p.Z,{children:(0,s.jsx)(P.Z,{title:"Forcing line breaks makes it easier to adjust column widths to your liking",children:(0,s.jsx)(ea.Z,{control:(0,s.jsx)(m.Z,{checked:"break-all"===r,onChange:e=>i(e.target.checked?"break-all":"break-word")}),label:"Force line breaks"})})}),(0,s.jsx)(p.Z,{children:(0,s.jsx)(ea.Z,{control:(0,s.jsx)(m.Z,{checked:d,onChange:e=>u(e.target.checked)}),label:"Render model outputs as Markdown"})}),(0,s.jsx)(p.Z,{children:(0,s.jsx)(ea.Z,{control:(0,s.jsx)(m.Z,{checked:x,onChange:e=>g(e.target.checked)}),label:"Prettify JSON outputs"})}),(0,s.jsx)(p.Z,{children:(0,s.jsx)(P.Z,{title:"Show the final prompt that produced the output in each cell.",children:(0,s.jsx)(ea.Z,{control:(0,s.jsx)(m.Z,{checked:j,onChange:e=>v(e.target.checked)}),label:"Show full prompt in output cell"})})}),(0,s.jsx)(p.Z,{children:(0,s.jsx)(P.Z,{title:"Show detailed inference statistics such as latency, tokens used, cost, etc.",children:(0,s.jsx)(ea.Z,{control:(0,s.jsx)(m.Z,{checked:o,onChange:e=>c(e.target.checked)}),label:"Show inference details"})})}),(0,s.jsxs)(p.Z,{maxWidth:"sm",children:[(0,s.jsxs)(f.Z,{mt:2,children:["Max text length: ",l]}),(0,s.jsx)(eL.ZP,{min:25,max:1e3,value:l,onChange:(e,t)=>a(t)})]})]}),(0,s.jsx)(ec.Z,{children:(0,s.jsx)(h.Z,{onClick:n,children:"Close"})})]})},eU=n(1938),eA=n(7580);let eW=eA.env.NEXT_PUBLIC_PROMPTFOO_REMOTE_API_BASE_URL||eA.env.NEXT_PUBLIC_PROMPTFOO_BASE_URL||eA.env.PROMPTFOO_REMOTE_API_BASE_URL||"https://api.promptfoo.dev",e_=eA.env.NEXT_PUBLIC_PROMPTFOO_BASE_URL||eA.env.PROMPTFOO_REMOTE_APP_BASE_URL||"https://app.promptfoo.dev";n(6911);let ez=(0,O.Z)(R.Z)(e=>{let{theme:t}=e;return{maxWidth:"100%",flexWrap:"wrap",[t.breakpoints.down("sm")]:{flexDirection:"column"}}});function eV(e){let{recentEvals:t,onRecentEvalSelected:n,defaultEvalId:i}=e,c=(0,o.useRouter)(),{table:R,config:O,setConfig:M,maxTextLength:T,wordBreak:L,showInferenceDetails:D,evalId:U}=W(),{setStateFromConfig:A}=(0,eU.o)(),[z,V]=l.useState(""),[B]=(0,F.Nr)(z,1e3),[J,H]=l.useState({}),G=l.useCallback((e,t)=>{H(n=>({...n,[e]:t}))},[H]),[X,Y]=l.useState("all"),[q,$]=l.useState(!1),[K,Q]=l.useState(""),[et,en]=l.useState(!1),es=async()=>{en(!0);try{let e=await fetch("".concat(eW,"/api/eval"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{version:2,createdAt:new Date().toISOString(),results:{table:R},config:O}})}),{id:t}=await e.json(),n="".concat(e_,"/eval/").concat(t);Q(n),$(!0)}catch(e){alert("Sorry, something went wrong.")}finally{en(!1)}},[el,ea]=l.useState(!1),[er,ei]=l.useState(!1);(0,a.Z)(R,"Table data must be loaded before rendering ResultsView");let{head:eo}=R,ec=async()=>{(0,a.Z)(O,"Config must be loaded before clicking its description");let e=window.prompt("Enter new description:",O.description);if(null!==e&&e!==O.description){let t={...O,description:e};try{let e=await fetch("".concat(await (0,eS.b)(),"/api/eval/").concat(U),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:t})});if(!e.ok)throw Error("Network response was not ok");M(t)}catch(e){console.error("Failed to update table:",e)}}},ed=async()=>{if(window.confirm("Are you sure you want to delete this evaluation?"))try{let e=await fetch("".concat(await (0,eS.b)(),"/api/eval/").concat(U),{method:"DELETE"});if(!e.ok)throw Error("Network response was not ok");c.push("/")}catch(e){console.error("Failed to delete evaluation:",e),alert("Failed to delete evaluation")}},eu=l.useMemo(()=>[...eo.vars.map((e,t)=>({value:"Variable ".concat(t+1),label:"Var ".concat(t+1,": ").concat(eo.vars[t].length>100?eo.vars[t].slice(0,97)+"...":eo.vars[t]),group:"Variables"})),...eo.prompts.map((e,t)=>{let n=eo.prompts[t],s=n.label||n.display||n.raw;return{value:"Prompt ".concat(t+1),label:"Prompt ".concat(t+1,": ").concat(s.length>100?s.slice(0,97)+"...":s),group:"Prompts"}})],[eo.vars,eo.prompts]),[ep,eh]=l.useState({}),[em,ex]=l.useState(eu.map(e=>e.value)),[eg,ej]=l.useState(null);return(0,s.jsxs)("div",{style:{marginLeft:"1rem",marginRight:"1rem"},children:[(0,s.jsx)(p.Z,{mb:2,sx:{display:"flex",alignItems:"center"},children:(0,s.jsxs)(f.Z,{variant:"h5",sx:{flexGrow:1},children:[(0,s.jsx)("span",{className:"description",onClick:ec,children:(null==O?void 0:O.description)||U})," ",(null==O?void 0:O.description)&&(0,s.jsx)("span",{className:"description-filepath",children:U})]})}),(0,s.jsx)(p.Z,{py:"md",children:(0,s.jsxs)(ez,{direction:"row",spacing:4,alignItems:"center",children:[(0,s.jsx)(p.Z,{children:t&&t.length>0&&(0,s.jsx)(j.Z,{sx:{m:1,minWidth:200},size:"small",children:(0,s.jsx)(u.Z,{size:"small",options:t,renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.id},t.label),style:{width:350},renderInput:e=>(0,s.jsx)(I.Z,{...e,label:"Eval run",variant:"outlined"}),defaultValue:t.find(e=>e.id===i)||t[0],onChange:(e,t)=>{t&&t.id&&n(t.id)},disableClearable:!0})})}),(0,s.jsx)(p.Z,{children:(0,s.jsxs)(j.Z,{sx:{m:1,minWidth:200,maxWidth:350},size:"small",children:[(0,s.jsx)(v.Z,{id:"visible-columns-label",children:"Columns"}),(0,s.jsx)(w.Z,{labelId:"visible-columns-label",id:"visible-columns",multiple:!0,value:em,onChange:e=>{let{target:{value:t}}=e;ex("string"==typeof t?t.split(","):t);let n=[...eo.vars.map((e,t)=>"Variable ".concat(t+1)),...eo.prompts.map((e,t)=>"Prompt ".concat(t+1))],s={};n.forEach(e=>{s[e]=("string"==typeof t?t.split(","):t).includes(e)}),eh(s)},input:(0,s.jsx)(k.Z,{label:"Visible columns"}),renderValue:e=>e.join(", "),children:eu.map(e=>(0,s.jsxs)(C.Z,{dense:!0,value:e.value,children:[(0,s.jsx)(m.Z,{checked:em.indexOf(e.value)>-1}),(0,s.jsx)(b.Z,{primary:e.label})]},e.value))})]})}),(0,s.jsx)(p.Z,{children:(0,s.jsxs)(j.Z,{sx:{minWidth:180},size:"small",children:[(0,s.jsx)(v.Z,{id:"failure-filter-mode-label",children:"Display"}),(0,s.jsxs)(w.Z,{labelId:"filter-mode-label",id:"filter-mode",value:X,onChange:e=>{let t=e.target.value;Y(t);let n={};eo.prompts.forEach((e,s)=>{n["Prompt ".concat(s+1)]="failures"===t}),H(n)},label:"Filter",children:[(0,s.jsx)(C.Z,{value:"all",children:"Show all results"}),(0,s.jsx)(C.Z,{value:"failures",children:"Show failures only"}),(0,s.jsx)(C.Z,{value:"different",children:"Show different only"})]})]})}),(0,s.jsx)(p.Z,{children:(0,s.jsx)(I.Z,{sx:{minWidth:180},size:"small",label:"Search",placeholder:"Text or regex",value:z,onChange:e=>{V(e.target.value)}})}),(0,s.jsx)(p.Z,{flexGrow:1}),(0,s.jsx)(p.Z,{display:"flex",justifyContent:"flex-end",children:(0,s.jsxs)(ez,{direction:"row",spacing:2,children:[(0,s.jsx)(h.Z,{color:"primary",onClick:e=>{ej(e.currentTarget)},startIcon:(0,s.jsx)(d.Z,{}),children:"Eval actions"}),O&&(0,s.jsxs)(Z.Z,{id:"eval-actions-menu",anchorEl:eg,keepMounted:!0,open:!!eg,onClose:()=>{ej(null)},children:[(0,s.jsx)(P.Z,{title:"View the configuration that defines this eval",placement:"left",children:(0,s.jsxs)(C.Z,{onClick:()=>ea(!0),children:[(0,s.jsx)(y.Z,{children:(0,s.jsx)(E.Z,{fontSize:"small"})}),"View YAML"]})}),(0,s.jsx)(P.Z,{title:"Edit this eval in the web UI",placement:"left",children:(0,s.jsxs)(C.Z,{onClick:()=>{A(O),c.push("/setup/")},children:[(0,s.jsx)(y.Z,{children:(0,s.jsx)(g.Z,{fontSize:"small"})}),"Edit Eval"]})}),(0,s.jsx)(_,{}),(null==O?void 0:O.sharing)&&(0,s.jsx)(P.Z,{title:"Generate a unique URL that others can access",placement:"left",children:(0,s.jsxs)(C.Z,{onClick:es,disabled:et,children:[(0,s.jsx)(y.Z,{children:et?(0,s.jsx)(r.Z,{size:16}):(0,s.jsx)(N.Z,{fontSize:"small"})}),"Share"]})}),(0,s.jsx)(P.Z,{title:"Delete this eval",placement:"left",children:(0,s.jsxs)(C.Z,{onClick:ed,children:[(0,s.jsx)(y.Z,{children:(0,s.jsx)(x.Z,{fontSize:"small"})}),"Delete"]})})]}),(0,s.jsx)(P.Z,{title:"Edit table view settings",placement:"bottom",children:(0,s.jsx)(h.Z,{color:"primary",onClick:()=>ei(!0),startIcon:(0,s.jsx)(S.Z,{}),children:"Table Settings"})})]})})]})}),(0,s.jsx)(ee,{columnVisibility:ep}),(0,s.jsx)(eO,{maxTextLength:T,columnVisibility:ep,wordBreak:L,showStats:D,filterMode:X,failureFilter:J,searchText:B,onFailureFilterToggle:G}),(0,s.jsx)(eM,{open:el,onClose:()=>ea(!1)}),(0,s.jsx)(eT,{open:q,onClose:()=>$(!1),shareUrl:K}),(0,s.jsx)(eD,{open:er,onClose:()=>ei(!1)})]})}var eB=n(279);async function eJ(){let e=(0,c.createClientComponentClient)(),{data:{user:t}}=await e.auth.getUser();(0,a.Z)(t,"User not logged in");let{data:n,error:s}=await e.from("EvaluationResult").select("id, createdAt").eq("user_id",t.id).order("createdAt",{ascending:!1}).limit(100);return n||[]}async function eH(e){let t=(0,c.createClientComponentClient)(),{data:n,error:s}=await t.from("EvaluationResult").select("*").eq("id",e).single();return n}function eG(e){var t;let{fetchId:n,preloadedData:c,recentEvals:d,defaultEvalId:u}=e,p=(0,o.useRouter)(),{table:h,setTable:m,setConfig:x,setEvalId:g}=W(),[j,f]=l.useState(!1),[v,b]=l.useState(!1),[y,Z]=l.useState(d||[]),C=async()=>{let e=await fetch("".concat(await (0,eS.b)(),"/api/results"),{cache:"no-store"}),t=await e.json();return Z(t.data),t.data},k=l.useCallback(async e=>{let t=await fetch("".concat(await (0,eS.b)(),"/api/results/").concat(e),{cache:"no-store"}),n=await t.json();m(n.data.results.table),x(n.data.config),g(e)},[m,x,g]),w=async e=>{eB.Ox?(f(!1),p.push("/eval/remote:".concat(encodeURIComponent(e)))):p.push("/eval/?evalId=".concat(encodeURIComponent(e)))},[S,N]=l.useState(u||(null===(t=y[0])||void 0===t?void 0:t.id)),R=(0,o.useSearchParams)(),I=R?R.get("evalId"):null;return(l.useEffect(()=>{if(I){let e=async()=>{await k(I),f(!0),N(I),C()};e()}else if(c){var e;m(null===(e=c.data.results)||void 0===e?void 0:e.table),x(c.data.config),f(!0)}else if(n){let e=async()=>{var e;let t="".concat(eW,"/api/eval/").concat(n);console.log("Fetching eval from remote server",t);let s=await fetch(t);if(!s.ok){b(!0);return}let l=await s.json();m(null===(e=l.data.results)||void 0===e?void 0:e.table),x(l.data.config),f(!0)};e()}else if(eB.T8)(0,eS.b)().then(e=>{let t=(0,i.io)(e);return t.on("init",e=>{console.log("Initialized socket connection",e),f(!0),m(null==e?void 0:e.results.table),x(null==e?void 0:e.config),C().then(e=>{var t,n;N(null===(t=e[0])||void 0===t?void 0:t.id),g(null===(n=e[0])||void 0===n?void 0:n.id)})}),t.on("update",e=>{console.log("Received data update",e),m(e.results.table),x(e.config),C().then(e=>{var t;let n=null===(t=e[0])||void 0===t?void 0:t.id;n&&(N(n),g(n))})}),()=>{t.disconnect()}});else if(eB.Ox)eJ().then(e=>{Z(e.map(e=>({id:e.id,label:e.createdAt}))),e.length>0&&eH(e[0].id).then(t=>{(0,a.Z)(t,"Eval not found");let n=t.results,s=t.config;N(e[0].id),m(n.table),x(s),f(!0)})});else{let e=async()=>{let e=await C();if(!(e.length>0))return(0,s.jsx)("div",{className:"notice",children:"No evals yet. Share some evals to this server and they will appear here."});{let t=await (0,eS.b)(),n=e[0].id,s=await fetch("".concat(t,"/api/results/").concat(n)),l=await s.json();m(l.data.results.table),x(l.data.config),f(!0),N(n),g(n)}};e()}},[n,m,x,g,k,c,N,I]),v)?(0,s.jsx)("div",{className:"notice",children:"404 Eval not found"}):j&&h?(0,s.jsx)(eV,{defaultEvalId:S,recentEvals:y,onRecentEvalSelected:w}):(0,s.jsxs)("div",{className:"notice",children:[(0,s.jsx)("div",{children:(0,s.jsx)(r.Z,{size:22})}),(0,s.jsx)("div",{children:"Loading eval data"})]})}n(5038)},279:function(e,t,n){"use strict";n.d(t,{Ox:function(){return a},T8:function(){return l},eA:function(){return r}});var s=n(7580);let l=!s.env.NEXT_PUBLIC_PROMPTFOO_BUILD_STANDALONE_SERVER,a=!!s.env.NEXT_PUBLIC_PROMPTFOO_USE_SUPABASE,r=""},1938:function(e,t,n){"use strict";n.d(t,{o:function(){return a}});var s=n(4660),l=n(4810);let a=(0,s.Ue)()((0,l.tJ)((e,t)=>({env:{},testCases:[],description:"",providers:[],prompts:[],defaultTest:{},evaluateOptions:{},setEnv:t=>e({env:t}),setTestCases:t=>e({testCases:t}),setDescription:t=>e({description:t}),setProviders:t=>e({providers:t}),setPrompts:t=>e({prompts:t}),setDefaultTest:t=>e({defaultTest:t}),setEvaluateOptions:t=>e({evaluateOptions:t}),setStateFromConfig:t=>{let n={};t.description&&(n.description=t.description||""),t.tests&&(n.testCases=t.tests),t.providers&&(n.providers=t.providers),t.prompts&&("string"==typeof t.prompts?n.prompts=[t.prompts]:Array.isArray(t.prompts)?n.prompts=t.prompts.filter(e=>"string"==typeof e&&!e.endsWith(".txt")&&!e.endsWith(".json")&&!e.endsWith(".yaml")):console.warn("Invalid prompts config",t.prompts)),e(n)},getTestSuite:()=>{let{description:e,testCases:n,providers:s,prompts:l,env:a}=t();return{env:a,description:e,providers:s,prompts:l,tests:n}}}),{name:"promptfoo",skipHydration:!0}))},8715:function(){},5038:function(){},2604:function(){},6911:function(){},5777:function(){}}]);